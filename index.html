<!DOCTYPE html> 
<html> 
<head> 
	<title>PCOApp</title> 
	
	<meta name="viewport" content="width=device-width, initial-scale=1"> 

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.1/jquery.mobile-1.2.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.2.1/jquery.mobile-1.2.1.min.js"></script>
</head>

<style>

	@media only screen and (min-width: 480px)
	{
        .ui-page
		{
            width: 480px !important;
            margin: 0 auto !important;
            position: relative !important;
            border-right: 5px #666 outset !important;
            border-left: 5px #666 outset !important;
        }
    }

</style>

<body> 

<div data-role="page" id="connection">

	<div data-role="header">
		<h1>PCOApp</h1>
	</div>

	<div data-role="content">
	
		<div><br/><br/><br/><br/><br/></div>
	
		<div id="connection">
			<center><button id="btnConnect" class="ui-btn">connect to a PCOA device</button></center>
		</div>
		
		<div><br/><br/><br/></div>
		
		<center><div class="error" id="error"></div></center>
		
	</div>

</div>


<div data-role="page" id="settings">

	<div data-role="header">
		<h1>PCOApp</h1>
	</div>

	<div data-role="content">
	
		<table>
			
			<tr>
				<td colspan="2"><span class="header">
					<h3>PCOA_prototype</h3>
					
				</td>
			</tr>
			
			<tr><td><br/></td></tr>
			<tr>
				<td colspan="2">
					<center><button id="btnLoad" class="ui-btn"><span>load pills</span></button></center>
				</td>
			</tr>
			
			<tr><td><br/></td></tr>
			<tr class="blank_row"></tr><tr class="blank_row"></tr>
			<tr>
				<td rowspan="2"><h3>Alarm&nbsp;&nbsp;&nbsp;</h3></td>
				<td width="100%">
					<div id="alarmHours" class="just_slider">
						<input type="range" name="alarmHoursSlider" id="alarmHoursSlider" value="0" min="0" max="23">
					</div>
				</td>
			</tr>
			<tr>
				<td>
					<div id="alarmMinutes" class="just_slider">
						<input type="range" name="alarmMinutesSlider" id="alarmMinutesSlider" value="0" min="0" max="55" step="5">
					</div>
				</td>
			</tr>
			
			<tr><td><br/></td></tr>
			<tr>
				<td rowspan="2"><h3>Interval&nbsp;&nbsp;&nbsp;</h3></td>
				<td>
					<div id="intervalHours" class="just_slider">
						<input type="range" name="intervalHoursSlider" id="intervalHoursSlider" value="0" min="0" max="23">
					</div>
				</td>
			</tr>
			<tr>
				<td>
					<div id="alarmMinutes" class="just_slider">
						<input type="range" name="intervalMinutesSlider" id="intervalMinutesSlider" value="0" min="0" max="55" step="5">
					</div>
				</td>
			</tr>
			
			<tr><td><br/></td></tr>
			<tr>
				<td colspan="2">
					<center><button id="btnSave" class="ui-btn"><span>save settings</span></button></center>
				</td>
			</tr>
			
		</table>
		
	</div>
	
</div>

<script>
	$("#btnConnect").click(async function(event)
	{			
		event.preventDefault();
		
		$("#error").html(""); 
		try
		{
			device = await navigator.bluetooth.requestDevice({acceptAllDevices:true})
			password = prompt("Password");
			if(typeof(password) === "string" || password instanceof String)
			{
				if(true)
				{
					$.mobile.changePage("#settings");
				}
				else
				{
					$("#error").html
					(`
						<b style="color:red;">Invalid password</b>
					`); 
				}
			}
		}
		catch(error)
		{
			console.log("BLE requestDevice error : " + error);
			
			if(error.name === 'TypeError')
			{
				$("#error").html
				(`
					<b style="color:red;">Bluetooth Low Energy (BLE)<br/>is not supported on this browser</b><br/><br/><br/>
					On Google Chrome, you can enable it as <a href="https://developers.google.com/web/updates/2014/03/Get-on-the-CSS-Grid">here</a><br/>
					On iOS, you can use the <a href="https://itunes.apple.com/us/app/webble/id1193531073?mt=8">WebBLE</a> browser
				`); 
			}
			else if(error.name === 'NotFoundError')
			{
				if(!error.message.includes('User cancelled'))
				{
					$("#error").html
					(`
						<b style="color:red;">No device has been found nearby</b>
					`);
				}
			}
			else
			{
				$("#error").html
				(`
					<b style="color:red;">An unknown error occurred</b>
				`); 
			}
 
		}		
	});
</script>

</body>
</html>